# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
---
# Архитектура проекта
В проекте используется архитектурный паттерн MVP (Model-View-Presenter). В соответствии с данным паттерном приложение разделено на три основных слоя: слой данных (Model), слой отображения (View), и слой представления (Presenter). Слои модели и отображения не связаны между собой, взаимодействие между этими слоями организовано с помощью слоя представления. В архитектуре проекта применен событийно-ориентированный подход. 
## Базовый код
### 1. Класс `Api`
Базовый класс-клиент API для взаимодействия с сервером, предоставляет методы для выполнения HTTP-запросов к серверу и обработки ответа сервера.

Конструктор класса принимает два аргумента – базовый URL `baseURL` и объект опций HTTP-запроса `options`, инициализированный по умолчанию пустым объектом:
`constructor(baseUrl: string, options: RequestInit = {})`.

**Методы:**

- `handleResponse` – обработать ответ сервера.

- `get` – выполнить запрос данных с сервера.

- `post` – отправить данные на сервер.

### 2. Класс `Model<T>`
Базовый абстрактный класс модели данных. Содержит методы, общие для всех моделей данных. Класс является дженериком и принимает в переменной T тип данных объекта, передаваемого конструктору класса.

Конструктор класса принимает два аргумента – объект с частичными данными типа T `data` и объект брокера событий `events`:
`constructor(data: Partial<T>, protected events: IEvents)`.

**Методы:**

- `emitChanges` – метод сообщает об изменении модели данных с помощью брокера событий.

### 3. Класс `EventEmitter`
Базовый класс, представющий брокер событий. Класс реализует паттерн Наблюдатель (Observer) и предоставляет возможность управлять событиями в приложении: инициировать события, подписываться и реагировать на события.

Конструктор класса не принимает аргументов: `constructor()`.

**Методы:**

- `emit`, `on`, `off` – инициировать событие с данными, установить и снять обработчик с события соответственно.
- `onAll`, `offAll` – слушать все события и сбросить все обработчики событий соответственно.
- `trigger` – сделать коллбек триггер, генерирующий событие при вызове.

### 4. Класс `Component<T>`
Базовый абстрактный класс, наследуемый компонентами представления. Содержит методы для работы с DOM в дочерних компонентах.

Конструктор класса в качестве аргумента принимает DOM-элемент, который будет служить контейнером для компонента: `constructor(protected readonly container: HTMLElement)`.

**Методы:**

- `toggleClass` – переключить класс элемента.
- `setText` – установить текстовое содержимое элемента.
- `setDisabled` – изменить статус блокировки элемента.
- `setHidden`, `setVisible` – скрыть и показать элемент соответственно.
- `setImage` – установить изображение с альтернативным текстом.
- `render` – предназначен для перерисовки компонентов представления при изменении данных.

## Слой модели данных Model
### 1. Класс `WebLarekAPI`
Класс расширяет базовый класс `Api` и предназначен для работы с товарами и заказами на сервере посредством API. В классе реализована логика получения, отправки и обработки данных о товарах и заказах.

Конструктор класса, помимо аргументов родительского конструктора, принимает базовый URL для изображений `cdn`: `constructor(cdn: string, baseUrl: string, options?: RequestInit)`.

**Методы:**

- `getProductList(): Promise<IProduct[]>` – получить массив всех товаров с сервера.
- `getProductItem(id: string): Promise<IProduct>` – получить один товар с сервера по идентификатору.
- `orderProducts(order: IOrder): Promise<IOrderResult>` – отправить данные заказа на сервер.

### 2. Класс `AppState`
Класс расширяет базовый класс `Model<IAppState>` и предназначен для хранения и управления состоянием приложения. Поля класса хранят информацию о товарах, состоянии корзины и заказа, ошибках валидации полей в формах. Методы класса позволяют на уровне данных воспроизвести бизнес-логику приложения.

Конструктор родительского класса не переопределен.

**Поля:**

- `catalog: IProduct[]` - каталог товаров магазина.
- `basket: IProduct[]` - товары, добавленные в корзину.
- `order: IOrder` - данные заказа.
- `preview: string | null` - идентификатор просматриваемого товара.
- `formErrors: FormErrors` - объект для хранения ошибок валидации полей в формах.

**Методы:**

- `setCatalog(items: IProduct[])` – установить каталог товаров.
- `getCatalog` - получить каталог товаров.
- `setPreview(item: IProduct)` – установить просматриваемый товар.
- `getPreview` – получить просматриваемый товар.
- `addToBasket(item: IProduct)` – добавить товар в корзину.
- `setBasketItems(basket: IProduct[])` - установить массив товаров в корзине.
- `getBasketItems` – получить массив товаров в корзине.
- `getBasketAmount` – получить количество товаров в корзине.
- `getBasketTotal` – получить общую стоимость товаров в корзине.
- `deleteFromBasket(item: IProduct)` – удалить один товар из корзины.
- `deleteAllFromBasket` – удалить все товары из корзины.
- `setOrderData(order: IOrder)`– установить данные заказа.
- `resetOrderData` – сбросить данные заказа.
- `getOrderData` - получить данные заказа.
- `setOrderField(field: keyof IOrderForm, value: string)` – установить способ оплаты и адрес.
- `setContactsField(field: keyof IOrderContacts, value: string )` – установить почту и телефон.
- `validateOrder` – отвалидировать данные формы с адресом и оплатой.
- `validateContacts` – отвалидировать данные формы с контактами.
- `getFormErrors` - получить ошибки валидации форм.

## Слой представления View
### 1. Класс `Page`
Класс расширяет класс `Component<IPage>` и является глобальным контейнером. Класс предназначен для отображения и управления основными элементами страницы: каталогом товаров и корзиной со счетчиком товаров.

Конструктор класса принимает DOM-элемент контейнера для компонента страницы `container` и объект брокера событий `events`: `constructor(container: HTMLElement, protected events: IEvents)`. 

Для данных, влияющих на отображение компонента, предусмотрены **set-методы**:

- `set counter(value: number)` - устанавливает значение счетчика товаров в корзине.
- `set catalog(items: HTMLElement[])` - устанавливает карточки товаров в каталог.
- `set locked(value: boolean)` - устанавливает состояние блокировки страницы.

### 2. Класс `Modal`
Класс расширяет класс `Component<IModalData>` и является глобальным контейнером. Класс предназначен для отображения контента модальных окон.

Конструктор класса принимает DOM-элемент контейнера для компонента модального окна `container` и объект брокера событий `events`: `constructor(container: HTMLElement, protected events: IEvents)`. 

**Методы**:

- `set content(value: HTMLElement)` - устанавливает в качестве контента любую разметку, переданную аргументом.
- `open` - открывает модальное окно.
- `close` - сбрасывает контент и закрывает модальное окно.
- `render(data: IModalData)` - рендерит контент с учетом переданных данных и открывает модальное окно.
  
### 3. Класс `Card`
Класс расширяет класс `Component<ICard>` и предназначен для отображения компонента карточки товара, включая название товара, категорию и описание товара, изображение товара и цену.

Конструктор класса принимает имя блока `blockName` для поиска DOM-элементов по классам CSS внутри разных контейнеров, DOM-элемент контейнера для компонента карточки `container` и объект с колбэк-функциями для кнопки карточки товара `actions`: `constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions)`. 

**Методы**:

- `set id(value: string)` и `get id()`- устанавливает и возвращает идентификатор товара соответственно.
- `set title(value: string)` и `get title()` - устанавливает и возвращает название товара соответственно.
- `set price(value: number | null)` и `get price()` - устанавливает и возвращает стоимость товара соответственно.
- `set selected(value: boolean)` - меняет текст на кнопке товара, если товар добавлен в корзину.
- `set image(value: string)` - устанавливает изображение товара.
- `set category(value: Category)` - устанавливает категорию товара.
- `set description(value: string)` - устанавливает описание товара.
- `set index(value: number)` - устанавливает индекс товара.

### 4. Класс `Basket`
Класс расширяет класс `Component<IBasket>` и предназначен для отображения компонента корзины, включая список товаров в корзине и их общую стоимость.

Конструктор класса принимает DOM-элемент контейнера для компонента корзины `container` и объект брокера событий `events`:
`constructor(container: HTMLElement, protected events: IEvents)`.

**Методы**:

- `set items(items: HTMLElement[])` - устанавливает список товаров, добавленных в корзину.
- `set total(total: number)` - устанавливает общую стоимость товаров в корзине.

### 5. Класс `Form`
Класс расширяет класс `Component<IForm>` и предназначен для отображения компонента формы, предоставляет возможности для обработки событий ввода данных, валидации полей формы и отправки данных.

Конструктор класса принимает DOM-элемент контейнера для компонента формы `container` и объект брокера событий `events`:
`constructor(container: HTMLElement, protected events: IEvents)`.

**Методы**:
- `onInputChange(field: keyof T, value: string)` - обработчик событий ввода данных в поля формы, сообщает об изменении полей формы другим частям приложения.
- `set valid(value: boolean)` - переключает состояние кнопки отправки формы в зависимости от валидности полей.
- `set errors(value: string)` - устанавливает ошибки валидации формы.
- `render(state: Partial<T> & IFormState)` - рендерит форму с учетом состояния валидности.
  
### 6. Класс `Order`
Класс расширяет класс `Form<IOrderForm>` и предназначен для отображения формы заказа. Содержит методы для выбора способа оплаты и ввода адреса.

Конструктор класса принимает DOM-элемент контейнера для компонента формы `container` и объект брокера событий `events`: 
`constructor(container: HTMLElement, protected events: IEvents)`.

**Методы**:
- `set payment(value: Payment)` - устанавивает способ оплаты.
- `set address(value: string)` - устанавливает адрес.

### 7. Класс `Contacts`
Класс расширяет класс `Form<IContactsForm>` и предназначен для отображения формы контактов. Содержит методы для ввода адреса электронной почты и номера телефона.

Конструктор класса принимает DOM-элемент контейнера для компонента формы `container` и объект брокера событий `events`: 
`constructor(container: HTMLElement, protected events: IEvents)`.

**Методы**:
- `set email(value: string)` - устанавивает адрес электронной почты.
- `set phone(value: string)` - устанавливает номер телефона.
  
### 8. Класс `Success`
Класс расширяет базовый класс Component<ISuccess> и служит для отображения сообщения об успешной отправке заказа.

Конструктор класса принимает DOM-элемент контейнера для компонента `container` и объект с колбэк-функциями для кнопки возврата `actions`: `constructor(container: HTMLElement, actions: ISuccessActions)`. 

**Методы**:
- `set total(value: number)` - устанавливает общую сумму заказа.

## Слой презентера Presenter
Код презентера не выделен в отдельный класс, а размещен в основном скрипте приложения, в файле src/index.ts. В презентере реализована бизнес-логика приложения с помощью событийно-ориентированного подхода.

**Пример взаимодействия слоев приложения через события:**
1. Пользователь кликнул на кнопку `В корзину` в модальном окне товара - объект класса `Card` в слое представления генерирует событие `product:add`.
2. Презентер обрабатывает событие `product:add` и вызывает метод объекта класса `AppState` `addToBasket(item)` для добавления объекта товара в корзину в слое модели данных. 
3. Модель изменяет поле `basket` в объекте класса `AppState`, добавляя товар в массив товаров корзины и генерирует событие `basket:changed`.
4. Презентер обрабатывет событие `basket:changed` и запрвшивает у модели (объект класса `AppState`) данные:
   - методом `getBasketItems()` запрашивает из модели массив товаров в корзине `basket[]`, каждый объект массива передается в рендер объекту класса `Card`.
   - методом `getBasketTotal()` запрашивает из модели общую стоимость корзины и передает в рендер объекту класса `Basket` (поле `total`).
   - методом `getBasketAmount` запрашивает из модели количество товаров в корзине и передает в рендер объекту класса `Page` (поле `counter`).         
5. Перерисовываются компоненты `Card`, `Basket`, `Page`.
 
**Основные события:**
- `items:changed` - изменился каталог товаров.
- `card:select` - кликнули на карточку товара в каталоге.
- `preview:changed` - изменен открытый товар.
- `product:add` - товар добавлен в корзину.
- `product:delete` - товар удален из корзины.
- `basket:open` - корзина открыта.
- `basket:changed` - у корзины изменено содержимое или общая стоимость товаров в корзине.
- `order:open` - начато оформление заказа.
- `/^order\..*:change/` - изменился способ оплаты или адрес в форме заказа.
- `/^contacts\..*:change/` - изменилось одно из полей в форме контактов.
- `formErrors.order:change` - изменилось состояние валидации формы заказа.
- `formErrors.contacts:change` - изменилось состояние валидации формы контактов.
- `order:submit` - отправлена форма заказа с типом оплаты и адресом.
- `contacts:submit` - отправлена форма с контактами.
- `order:success` - заказ отправлен на сервер.
- `modal:open` - отрыто модальное окно.
- `modal:close` - закрыто модальное окно.
  
